<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Surviving The World‚Ñ¢</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#1a1a2e;font-family:'Segoe UI',Arial,sans-serif;overflow:hidden;color:#fff}

#menu{position:fixed;inset:0;background:linear-gradient(135deg,#0a0a15,#1a1a2e);
display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1000}
.logo{font-size:3em;color:#ffd700;text-shadow:0 0 30px rgba(255,215,0,0.5);margin-bottom:10px}
.subtitle{color:#888;margin-bottom:30px;letter-spacing:2px}
.chars{display:flex;gap:15px;flex-wrap:wrap;justify-content:center}
.char{width:140px;padding:20px;background:#12121f;border:2px solid #333;border-radius:12px;
cursor:pointer;text-align:center;transition:.3s}
.char:hover{border-color:#ffd700;transform:translateY(-5px)}
.char .icon{font-size:3em;margin-bottom:10px}
.char .name{font-weight:bold;margin-bottom:5px}
.char .stats{color:#888;font-size:10px}
.hint{color:#555;margin-top:30px;font-size:11px}

#game{display:none}
#c{position:fixed;top:0;left:0;width:100vw;height:100vh}

#hud{position:fixed;top:15px;left:15px;z-index:10;font-size:13px}
.bar-wrap{margin-bottom:8px}
.bar-label{margin-bottom:3px;font-size:11px;color:#aaa}
.bar{width:180px;height:14px;background:#222;border-radius:7px;overflow:hidden}
.bar-fill{height:100%;border-radius:7px;transition:width .3s}
.hp-fill{background:linear-gradient(90deg,#c0392b,#e74c3c)}
.st-fill{background:linear-gradient(90deg,#27ae60,#2ecc71)}
.hu-fill{background:linear-gradient(90deg,#d35400,#e67e22)}

#info{position:fixed;top:15px;right:15px;text-align:right;z-index:10}
#day{font-size:16px;color:#ffd700}
#weather{font-size:12px;color:#888;margin-top:3px}
#heat{margin-top:10px;font-size:11px}
.heat-tag{display:inline-block;padding:2px 8px;border-radius:10px;margin-left:5px;font-size:10px}
.calm{background:#27ae60}.alert{background:#f39c12;color:#000}.hunting{background:#e74c3c}.war{background:#8e44ad}

#minimap{position:fixed;bottom:15px;right:15px;width:150px;height:150px;
background:rgba(0,0,0,0.7);border:2px solid #ffd700;border-radius:8px;z-index:10}

#log{position:fixed;bottom:15px;left:15px;width:300px;max-height:150px;
background:rgba(0,0,0,0.7);border-radius:8px;padding:10px;z-index:10;overflow-y:auto;font-size:11px}
#log-title{color:#ffd700;margin-bottom:5px}
.log-entry{padding:3px 0;border-bottom:1px solid #222;color:#aaa}
.log-combat{color:#e74c3c}.log-quest{color:#ffd700}.log-ai{color:#3498db}

#controls{position:fixed;bottom:15px;left:50%;transform:translateX(-50%);
background:rgba(0,0,0,0.5);padding:8px 20px;border-radius:20px;z-index:10;font-size:11px;color:#666}
</style>
</head>
<body>
<div id="menu">
<div class="logo">‚öîÔ∏è SURVIVING THE WORLD‚Ñ¢</div>
<div class="subtitle">CLICK A CHARACTER TO START</div>
<div class="chars">
<div class="char" onclick="startGame(0)"><div class="icon">üó°Ô∏è</div><div class="name">Warrior</div><div class="stats">HP:150 | DMG:25 | SPD:5</div></div>
<div class="char" onclick="startGame(1)"><div class="icon">üèπ</div><div class="name">Ranger</div><div class="stats">HP:100 | DMG:20 | SPD:7</div></div>
<div class="char" onclick="startGame(2)"><div class="icon">ü•∑</div><div class="name">Assassin</div><div class="stats">HP:80 | DMG:35 | SPD:9</div></div>
<div class="char" onclick="startGame(3)"><div class="icon">üõ°Ô∏è</div><div class="name">Tank</div><div class="stats">HP:200 | DMG:15 | SPD:4</div></div>
<div class="char" onclick="startGame(4)"><div class="icon">üßô</div><div class="name">Survivor</div><div class="stats">HP:120 | DMG:18 | SPD:5</div></div>
</div>
<div class="hint">WASD=Move | Mouse=Look | SHIFT=Run | E=Interact | Q=Attack</div>
</div>

<div id="game">
<canvas id="c"></canvas>
<div id="hud">
<div class="bar-wrap"><div class="bar-label">‚ù§Ô∏è Health</div><div class="bar"><div class="bar-fill hp-fill" id="hp"></div></div></div>
<div class="bar-wrap"><div class="bar-label">‚ö° Stamina</div><div class="bar"><div class="bar-fill st-fill" id="st"></div></div></div>
<div class="bar-wrap"><div class="bar-label">üçñ Hunger</div><div class="bar"><div class="bar-fill hu-fill" id="hu"></div></div></div>
</div>
<div id="info">
<div id="day">Day 1 | 06:00</div>
<div id="weather">‚òÄÔ∏è Clear</div>
<div id="heat">
<div>Kingdom <span class="heat-tag calm" id="h-kingdom">CALM</span></div>
<div>Bandits <span class="heat-tag alert" id="h-bandits">ALERT</span></div>
</div>
</div>
<canvas id="minimap" width="150" height="150"></canvas>
<div id="log"><div id="log-title">üìú LOG</div><div id="log-entries"></div></div>
<div id="controls">WASD Move | Mouse Look | SHIFT Run | E Interact | Q Attack</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
// GAME VARIABLES
let scene,camera,renderer,clock,player;
let keys={},enemies=[],npcs=[],items=[];
let yaw=0,hp=100,maxHp=100,stamina=100,hunger=80,day=1,time=6;
let heat={kingdom:0,bandits:25};
const CHARS=[
{name:'Warrior',color:0xe74c3c,hp:150,spd:5,dmg:25},
{name:'Ranger',color:0x27ae60,hp:100,spd:7,dmg:20},
{name:'Assassin',color:0x2c3e50,hp:80,spd:9,dmg:35},
{name:'Tank',color:0x3498db,hp:200,spd:4,dmg:15},
{name:'Survivor',color:0x9b59b6,hp:120,spd:5,dmg:18}
];
let cfg;

window.startGame=function(i){
cfg=CHARS[i];hp=cfg.hp;maxHp=cfg.hp;
document.getElementById('menu').style.display='none';
document.getElementById('game').style.display='block';
init();
};

function init(){
// Scene
scene=new THREE.Scene();
scene.background=new THREE.Color(0x87CEEB);
scene.fog=new THREE.Fog(0x87CEEB,50,400);

// Camera
camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,500);

// Renderer
renderer=new THREE.WebGLRenderer({canvas:document.getElementById('c'),antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.shadowMap.enabled=true;

// Lights
scene.add(new THREE.AmbientLight(0xffffff,0.5));
const sun=new THREE.DirectionalLight(0xffffff,0.8);
sun.position.set(50,100,50);
sun.castShadow=true;
scene.add(sun);

// Ground
const ground=new THREE.Mesh(
new THREE.PlaneGeometry(500,500),
new THREE.MeshLambertMaterial({color:0x3d6b2e})
);
ground.rotation.x=-Math.PI/2;
ground.receiveShadow=true;
scene.add(ground);

// Roads
addRoad(0,0,500,12,0);
addRoad(0,0,12,500,0);

// Buildings
addBuilding(-50,-50,20,18,20,0x8B4513,'Tavern');
addBuilding(60,-40,25,22,25,0x696969,'Blacksmith');
addBuilding(-70,50,30,28,25,0x4a4a4a,'Castle');
addBuilding(80,60,18,14,18,0x8B7355,'Market');
for(let i=0;i<8;i++){
const x=(Math.random()-.5)*300,z=(Math.random()-.5)*300;
if(Math.abs(x)>40||Math.abs(z)>40)addBuilding(x,z,12,10,12,0x654321,'House');
}

// Trees
for(let i=0;i<80;i++){
const x=(Math.random()-.5)*400,z=(Math.random()-.5)*400;
if(Math.abs(x)>25||Math.abs(z)>25)addTree(x,z);
}

// Player
player=new THREE.Mesh(
new THREE.CapsuleGeometry(0.4,1.2,4,8),
new THREE.MeshLambertMaterial({color:cfg.color})
);
player.position.y=1;
player.castShadow=true;
scene.add(player);

// Enemies
for(let i=0;i<8;i++){
const x=(Math.random()-.5)*200,z=(Math.random()-.5)*200;
if(Math.abs(x)>30||Math.abs(z)>30)addEnemy(x,z,i<3);
}

// NPCs
addNPC(-45,-45,'Merchant',0xDAA520);
addNPC(65,-35,'Blacksmith',0x708090);
addNPC(-65,55,'Quest Giver',0x9370DB);

// Items
for(let i=0;i<20;i++){
const x=(Math.random()-.5)*300,z=(Math.random()-.5)*300;
addItem(x,z);
}

// Controls
document.addEventListener('keydown',e=>keys[e.code]=1);
document.addEventListener('keyup',e=>keys[e.code]=0);
document.addEventListener('mousemove',e=>{
if(document.pointerLockElement)yaw-=e.movementX*.002;
});
document.getElementById('c').onclick=()=>document.getElementById('c').requestPointerLock();
window.onresize=()=>{camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight);};

clock=new THREE.Clock();
log('Game started as '+cfg.name);
loop();
}

function addRoad(x,z,w,d,r){
const road=new THREE.Mesh(new THREE.PlaneGeometry(w,d),new THREE.MeshLambertMaterial({color:0x333333}));
road.rotation.x=-Math.PI/2;road.rotation.z=r;road.position.set(x,0.05,z);scene.add(road);
}

function addBuilding(x,z,w,h,d,color,name){
const g=new THREE.Group();
const body=new THREE.Mesh(new THREE.BoxGeometry(w,h,d),new THREE.MeshLambertMaterial({color}));
body.position.y=h/2;body.castShadow=true;g.add(body);
const roof=new THREE.Mesh(new THREE.ConeGeometry(Math.max(w,d)*.7,h*.3,4),new THREE.MeshLambertMaterial({color:0x8B0000}));
roof.position.y=h+h*.15;roof.rotation.y=Math.PI/4;g.add(roof);
g.position.set(x,0,z);g.userData={name};scene.add(g);
}

function addTree(x,z){
const g=new THREE.Group();
const trunk=new THREE.Mesh(new THREE.CylinderGeometry(.3,.5,4,6),new THREE.MeshLambertMaterial({color:0x4a3728}));
trunk.position.y=2;g.add(trunk);
const leaves=new THREE.Mesh(new THREE.SphereGeometry(2.5,6,5),new THREE.MeshLambertMaterial({color:0x228B22}));
leaves.position.y=5;g.add(leaves);
g.position.set(x,0,z);scene.add(g);
}

function addEnemy(x,z,hostile){
const e=new THREE.Mesh(new THREE.CapsuleGeometry(.4,1,4,6),new THREE.MeshLambertMaterial({color:hostile?0xB22222:0x4169E1}));
e.position.set(x,1,z);e.castShadow=true;
e.userData={hostile,hp:50,state:'patrol',vx:(Math.random()-.5)*2,vz:(Math.random()-.5)*2};
scene.add(e);enemies.push(e);
}

function addNPC(x,z,name,color){
const n=new THREE.Mesh(new THREE.CapsuleGeometry(.35,1.1,4,6),new THREE.MeshLambertMaterial({color}));
n.position.set(x,1,z);n.castShadow=true;
const ind=new THREE.Mesh(new THREE.SphereGeometry(.15,6,6),new THREE.MeshBasicMaterial({color:0xffff00}));
ind.position.y=1.5;n.add(ind);
n.userData={name};scene.add(n);npcs.push(n);
}

function addItem(x,z){
const colors=[0xff0000,0xdaa520,0xff00ff,0xffd700];
const types=['Apple','Bread','Potion','Coin'];
const i=Math.floor(Math.random()*4);
const item=new THREE.Mesh(new THREE.SphereGeometry(.25,8,8),new THREE.MeshBasicMaterial({color:colors[i]}));
item.position.set(x,.5,z);item.userData={type:types[i],collected:false};scene.add(item);items.push(item);
}

function loop(){
requestAnimationFrame(loop);
const dt=Math.min(clock.getDelta(),.05);

// Player movement
let dx=0,dz=0;
if(keys.KeyW)dz=-1;if(keys.KeyS)dz=1;
if(keys.KeyA)dx=-1;if(keys.KeyD)dx=1;
const run=keys.ShiftLeft&&stamina>0;
const spd=(run?cfg.spd*1.8:cfg.spd)*dt;
if(dx||dz){
const a=Math.atan2(dx,dz)+yaw;
player.position.x+=Math.sin(a)*spd;
player.position.z+=Math.cos(a)*spd;
if(run)stamina=Math.max(0,stamina-25*dt);
}
if(!run)stamina=Math.min(100,stamina+15*dt);
hunger=Math.max(0,hunger-.3*dt);
if(hunger<=0)hp-=dt*2;

// Bounds
player.position.x=Math.max(-230,Math.min(230,player.position.x));
player.position.z=Math.max(-230,Math.min(230,player.position.z));
player.rotation.y=yaw;

// Camera
camera.position.set(player.position.x-Math.sin(yaw)*8,player.position.y+4,player.position.z-Math.cos(yaw)*8);
camera.lookAt(player.position.x,player.position.y+1,player.position.z);

// Enemy AI
enemies.forEach(e=>{
if(e.userData.hp<=0){e.visible=false;return;}
const d=e.position.distanceTo(player.position);
if(e.userData.hostile){
if(d<30&&d>2){
const dir=player.position.clone().sub(e.position).normalize();
e.position.x+=dir.x*4*dt;e.position.z+=dir.z*4*dt;
e.userData.state='chase';
}else if(d<=2){
if(Math.random()<dt*2){hp-=10;log('Enemy hit you! -10 HP','combat');}
}else{
e.position.x+=e.userData.vx*dt;e.position.z+=e.userData.vz*dt;
if(Math.abs(e.position.x)>100){e.userData.vx*=-1;}
if(Math.abs(e.position.z)>100){e.userData.vz*=-1;}
e.userData.state='patrol';
}
}else{
e.position.x+=e.userData.vx*dt;e.position.z+=e.userData.vz*dt;
if(Math.abs(e.position.x)>100){e.userData.vx*=-1;}
if(Math.abs(e.position.z)>100){e.userData.vz*=-1;}
}
});

// Items bob
items.forEach(i=>{
if(!i.userData.collected){
i.position.y=.5+Math.sin(Date.now()*.003+i.position.x)*.1;
i.rotation.y+=dt;
}
});

// Interact (E)
if(keys.KeyE){
keys.KeyE=0;
npcs.forEach(n=>{
if(player.position.distanceTo(n.position)<3){
log(n.userData.name+': "Welcome, traveler!"','ai');
}
});
items.forEach(i=>{
if(!i.userData.collected&&player.position.distanceTo(i.position)<2){
i.userData.collected=true;i.visible=false;
log('Collected '+i.userData.type);
if(i.userData.type==='Apple'||i.userData.type==='Bread')hunger=Math.min(100,hunger+20);
if(i.userData.type==='Potion')hp=Math.min(maxHp,hp+30);
}
});
}

// Attack (Q)
if(keys.KeyQ){
keys.KeyQ=0;
enemies.forEach(e=>{
if(e.userData.hp>0&&player.position.distanceTo(e.position)<3){
e.userData.hp-=cfg.dmg;
log('Hit enemy for '+cfg.dmg+' damage!','combat');
if(e.userData.hp<=0){
log('Enemy killed!','combat');
heat.bandits=Math.min(100,heat.bandits+15);
}
}
});
}

// Time
time+=dt*.1;if(time>=24){time=0;day++;log('Day '+day+' begins');}

// Heat decay
heat.kingdom=Math.max(0,heat.kingdom-.2*dt);
heat.bandits=Math.max(0,heat.bandits-.2*dt);

// Update HUD
document.getElementById('hp').style.width=(hp/maxHp*100)+'%';
document.getElementById('st').style.width=stamina+'%';
document.getElementById('hu').style.width=hunger+'%';
document.getElementById('day').textContent='Day '+day+' | '+String(Math.floor(time)).padStart(2,'0')+':'+String(Math.floor((time%1)*60)).padStart(2,'0');
document.getElementById('h-kingdom').textContent=heat.kingdom<25?'CALM':heat.kingdom<50?'ALERT':'HUNTING';
document.getElementById('h-kingdom').className='heat-tag '+(heat.kingdom<25?'calm':heat.kingdom<50?'alert':'hunting');
document.getElementById('h-bandits').textContent=heat.bandits<25?'CALM':heat.bandits<50?'ALERT':'HUNTING';
document.getElementById('h-bandits').className='heat-tag '+(heat.bandits<25?'calm':heat.bandits<50?'alert':'hunting');

// Minimap
const ctx=document.getElementById('minimap').getContext('2d');
ctx.fillStyle='#111';ctx.fillRect(0,0,150,150);
ctx.fillStyle='#ffd700';ctx.beginPath();ctx.arc(75,75,4,0,Math.PI*2);ctx.fill();
ctx.strokeStyle='#ffd700';ctx.beginPath();ctx.moveTo(75,75);ctx.lineTo(75-Math.sin(yaw)*12,75-Math.cos(yaw)*12);ctx.stroke();
enemies.forEach(e=>{
if(e.userData.hp<=0)return;
const ex=75+(e.position.x-player.position.x)*.3,ez=75+(e.position.z-player.position.z)*.3;
if(ex>0&&ex<150&&ez>0&&ez<150){
ctx.fillStyle=e.userData.hostile?'#f44':'#48f';ctx.beginPath();ctx.arc(ex,ez,3,0,Math.PI*2);ctx.fill();
}
});
npcs.forEach(n=>{
const nx=75+(n.position.x-player.position.x)*.3,nz=75+(n.position.z-player.position.z)*.3;
if(nx>0&&nx<150&&nz>0&&nz<150){
ctx.fillStyle='#0f0';ctx.beginPath();ctx.arc(nx,nz,3,0,Math.PI*2);ctx.fill();
}
});

// Death check
if(hp<=0){
log('YOU DIED! Respawning...','combat');
hp=maxHp;player.position.set(0,1,0);
}

renderer.render(scene,camera);
}

function log(msg,type=''){
const el=document.getElementById('log-entries');
const div=document.createElement('div');
div.className='log-entry'+(type?' log-'+type:'');
div.textContent='['+String(Math.floor(time)).padStart(2,'0')+':'+String(Math.floor((time%1)*60)).padStart(2,'0')+'] '+msg;
el.insertBefore(div,el.firstChild);
while(el.children.length>15)el.removeChild(el.lastChild);
}
</script>
</body>
</html>
